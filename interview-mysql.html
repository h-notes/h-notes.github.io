<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-04-07 二 17:12 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="melp" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/styles/readtheorg/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org29118f8">Notes</a>
<ul>
<li><a href="#orgfce6cbc">Index Strategies</a>
<ul>
<li><a href="#orga7e18b5">Isolating the Column&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></a></li>
<li><a href="#org3cb1216">Index Selectivity&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></a></li>
<li><a href="#org4e9c40d">Mysql Explain Command&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></a></li>
<li><a href="#org218dfca">Multicolumn Indexes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></a></li>
<li><a href="#orgd29f482">Clustered Indexes (innodb B+ tree index)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></a></li>
</ul>
</li>
<li><a href="#orgd97c84d">MySQL transpose op table&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></a></li>
<li><a href="#orgc59cd78">not in vs not existed difference&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></a></li>
<li><a href="#org892c0a0">fetch top n rows&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></a></li>
<li><a href="#org6871520">sql views&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></a></li>
<li><a href="#orgba097d9">sql DCL(data control language) commands&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></a></li>
<li><a href="#orgcf33542">insert into syntax&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></a></li>
<li><a href="#orge69a010">update statements&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></a></li>
<li><a href="#org5002616">一些具体的查询问题&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></a></li>
<li><a href="#org8820501">Hash index&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></a></li>
<li><a href="#org0186085">Dockerfile ONBUILD command&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></a></li>
<li><a href="#orge6b491a">MySQL index notion&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></a></li>
<li><a href="#org337d456">B+ tree index limits&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></a></li>
<li><a href="#orga68e3e5">full-text index&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org29118f8" class="outline-2">
<h2 id="org29118f8">Notes</h2>
<div class="outline-text-2" id="text-org29118f8">
</div>
<div id="outline-container-orgfce6cbc" class="outline-3">
<h3 id="orgfce6cbc">Index Strategies</h3>
<div class="outline-text-3" id="text-orgfce6cbc">
</div>
<div id="outline-container-orga7e18b5" class="outline-4">
<h4 id="orga7e18b5">Isolating the Column&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></h4>
<div class="outline-text-4" id="text-orga7e18b5">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2020-04-06 一 15:14]</span></span>
</p>

<p>
“Isolating” the column means it should not be part of an expression or be inside a function in the query.
</p>

<p>
如果查询条件语句中的行在表达式中而不是孤立地，那么该行不会使用任何索引.
</p>
</div>
</div>
<div id="outline-container-org3cb1216" class="outline-4">
<h4 id="org3cb1216">Index Selectivity&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></h4>
<div class="outline-text-4" id="text-org3cb1216">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2020-04-06 一 15:19]</span></span>
</p>

<p>
index selectivity 是 index column 中不同的值个数 除以 总行数。
</p>

<p>
一个 unique index 的 index selectivity 是 1, index selectivity 越高，匹配时过滤掉的行就越多。
</p>
</div>
</div>
<div id="outline-container-org4e9c40d" class="outline-4">
<h4 id="org4e9c40d">Mysql Explain Command&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></h4>
<div class="outline-text-4" id="text-org4e9c40d">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2020-04-06 一 15:42]</span></span>
</p>

<p>
Explain 展示了 sql 语句的执行计划，EXPLAIN works with SELECT, DELETE, INSERT, REPLACE, and UPDATE statements.
</p>
</div>

<ul class="org-ul">
<li><a id="org187bf06"></a>常见字段<br />
<ul class="org-ul">
<li><a id="org2508a3a"></a>select<sub>type</sub><br />
<div class="outline-text-6" id="text-org2508a3a">
<ul class="org-ul">
<li>simple: Simple SELECT (not using UNION or subqueries)</li>
<li>primary: 最外层 SELECT</li>
<li>union: Second or later SELECT statement in a UNION</li>
<li>union result: Result of a UNION.</li>
<li>subquery</li>
</ul>
</div>
</li>

<li><a id="org53c386e"></a>type<br />
<div class="outline-text-6" id="text-org53c386e">
<p>
The join type.
</p>
<ul class="org-ul">
<li>index<sub>merge</sub>: 使用了多个索引，而不是单个索引</li>
</ul>
<p>
<a href="https://dev.mysql.com/doc/refman/5.7/en/explain-output.html#jointype_index_merge">https://dev.mysql.com/doc/refman/5.7/en/explain-output.html#jointype_index_merge</a>     
<a href="https://dev.mysql.com/doc/refman/5.7/en/index-merge-optimization.html">https://dev.mysql.com/doc/refman/5.7/en/index-merge-optimization.html</a>
</p>

<p>
The index merge strategy sometimes works very well, but it’s more common for it to
actually be an indication of a poorly indexed table。
</p>
</div>
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-org218dfca" class="outline-4">
<h4 id="org218dfca">Multicolumn Indexes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></h4>
<div class="outline-text-4" id="text-org218dfca">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2020-04-06 一 16:02]</span></span>
</p>

<p>
依照查询语句，设计多行索引，而不是多个单行索引。
多个单行索引也会使用索引，但是是使用 index<sub>merge</sub>。
</p>
</div>

<ul class="org-ul">
<li><a id="orgb2b5570"></a>Choosing a Good Column Order (B+ tree index)<br />
<div class="outline-text-6" id="text-orgb2b5570">
<ol class="org-ol">
<li>place the most selective columns first in the index。</li>
</ol>
</div>
</li>
</ul>
</div>
<div id="outline-container-orgd29f482" class="outline-4">
<h4 id="orgd29f482">Clustered Indexes (innodb B+ tree index)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></h4>
<div class="outline-text-4" id="text-orgd29f482">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2020-04-06 一 16:16]</span></span>
</p>

<ol class="org-ol">
<li>B+ tree 中叶子节点存储在整个行，内部节点只存储了被索引的行（indexed column)</li>
<li>再 innodb 中，表实际上就是存储在 B+ tree 中，有一个主键作为索引，该索引要么是显式的要么是隐式的。
如此以来，在 innodb 中插入数据的速度依赖于数据插入的顺序是否是主键顺序。</li>

<li>Secondary (nonclustered index) indexes 中叶子节点并不保存完整的行数据，而是行主键值。</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-orgd97c84d" class="outline-3">
<h3 id="orgd97c84d">MySQL transpose op table&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></h3>
<div class="outline-text-3" id="text-orgd97c84d">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2020-04-03 五 15:37]</span></span>
</p>

<p>
<a href="https://stackoverflow.com/questions/3392956/sql-how-to-transpose">https://stackoverflow.com/questions/3392956/sql-how-to-transpose</a>
</p>
</div>
</div>
<div id="outline-container-orgc59cd78" class="outline-3">
<h3 id="orgc59cd78">not in vs not existed difference&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></h3>
<div class="outline-text-3" id="text-orgc59cd78">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2020-04-03 五 15:13]</span></span>
</p>

<p>
<a href="https://sqlinthewild.co.za/index.php/2010/02/18/not-exists-vs-not-in/">https://sqlinthewild.co.za/index.php/2010/02/18/not-exists-vs-not-in/</a>
</p>

<p>
当跟随在 not in 或者 not existed 的 subquery 结果中出现 null 时，两者出现不同的结果。
当 not in 后面的子查询集合结果中有 null 出现，那么 not in 所在的 select 返回 null
</p>
</div>
</div>
<div id="outline-container-org892c0a0" class="outline-3">
<h3 id="org892c0a0">fetch top n rows&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></h3>
<div class="outline-text-3" id="text-org892c0a0">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2020-04-03 五 15:46]</span></span>
</p>

<p>
select &#x2026; order by num desc limit 10
</p>
</div>
</div>
<div id="outline-container-org6871520" class="outline-3">
<h3 id="org6871520">sql views&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></h3>
<div class="outline-text-3" id="text-org6871520">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2020-04-04 六 09:05]</span></span>
</p>

<ol class="org-ol">
<li>概念</li>
</ol>

<p>
in sql，view 是一个虚拟 Table，它一般基于一个 sql 查询语句的结果集进行创建。
</p>

<p>
也就是说，view 是一个逻辑结构，它不会实际存储数据，每次对它的查询，实际上都会去查询底层的 Table.
</p>

<ol class="org-ol">
<li><p>
create view
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">CREATE</span> <span style="color: #4f97d7; font-weight: bold;">VIEW</span> <span style="color: #bc6ec5; font-weight: bold;">view_name</span> <span style="color: #4f97d7; font-weight: bold;">AS</span>
<span style="color: #4f97d7; font-weight: bold;">SELECT</span> column1, column2, ...
<span style="color: #4f97d7; font-weight: bold;">FROM</span> <span style="color: #4f97d7; font-weight: bold;">table_name</span>
<span style="color: #4f97d7; font-weight: bold;">WHERE</span> condition;
</pre>
</div></li>

<li><p>
update view
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">CREATE</span> <span style="color: #4f97d7; font-weight: bold;">OR</span> REPLACE <span style="color: #4f97d7; font-weight: bold;">VIEW</span> <span style="color: #bc6ec5; font-weight: bold;">view_name</span> <span style="color: #4f97d7; font-weight: bold;">AS</span>
  <span style="color: #4f97d7; font-weight: bold;">SELECT</span> column1, column2, ...
    <span style="color: #4f97d7; font-weight: bold;">FROM</span> <span style="color: #4f97d7; font-weight: bold;">table_name</span>
   <span style="color: #4f97d7; font-weight: bold;">WHERE</span> condition;
</pre>
</div></li>

<li><p>
drop view
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">DROP</span> <span style="color: #4f97d7; font-weight: bold;">VIEW</span> <span style="color: #bc6ec5; font-weight: bold;">view_name</span>;
</pre>
</div></li>

<li><p>
why you create view.
</p>

<p>
5.1 views 可以隐藏复杂性
</p>

<p>
当你有一个比较大并且逻辑比较复杂的查询时，你可以把这些复杂性写进 view，然后再去查询 view.
</p>

<p>
5.2 views 可以被用作一种安全机制
</p>

<p>
也就是说，你可以将 permissions 权限设置在 view 上而不是底层的表结构上。
</p>

<p>
5.3 views 可以简化重构
</p>

<p>
在你想重构一张 Table 的时候，你会破坏依赖于这张表的代码，你可以用 view 先暂时代替原来的 Table。然后再去重构相关的表，以及代码。
</p></li>
</ol>
</div>
</div>
<div id="outline-container-orgba097d9" class="outline-3">
<h3 id="orgba097d9">sql DCL(data control language) commands&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></h3>
<div class="outline-text-3" id="text-orgba097d9">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2020-04-04 六 09:37]</span></span>
</p>

<ol class="org-ol">
<li><b>GRANT</b> it gives a privilege to user.</li>
<li><b>REVOKE</b> it takes back privileges from user.</li>
</ol>
</div>
</div>
<div id="outline-container-orgcf33542" class="outline-3">
<h3 id="orgcf33542">insert into syntax&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></h3>
<div class="outline-text-3" id="text-orgcf33542">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2020-04-04 六 09:56]</span></span>
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">INSERT</span> <span style="color: #4f97d7; font-weight: bold;">INTO</span> <span style="color: #4f97d7; font-weight: bold;">table_name</span> <span style="color: #4f97d7;">(</span>column1, column2, column3, ...<span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">VALUES</span> <span style="color: #4f97d7;">(</span>value1, value2, value3, ...<span style="color: #4f97d7;">)</span>;
</pre>
</div>
</div>
</div>
<div id="outline-container-orge69a010" class="outline-3">
<h3 id="orge69a010">update statements&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></h3>
<div class="outline-text-3" id="text-orge69a010">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2020-04-04 六 09:58]</span></span>
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">UPDATE</span> <span style="color: #4f97d7; font-weight: bold;">table_name</span>
<span style="color: #4f97d7; font-weight: bold;">SET</span> column1 = value1, column2 = value2, ...
<span style="color: #4f97d7; font-weight: bold;">WHERE</span> condition;
</pre>
</div>
</div>
</div>
<div id="outline-container-org5002616" class="outline-3">
<h3 id="org5002616">一些具体的查询问题&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></h3>
<div class="outline-text-3" id="text-org5002616">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2020-04-04 六 10:04]</span></span>
</p>

<ol class="org-ol">
<li><p>
SQL query to find second maximum salary of Employee
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">select</span> <span style="color: #4f97d7;">max</span><span style="color: #4f97d7;">(</span>salary<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7; font-weight: bold;">from</span> employees <span style="color: #4f97d7; font-weight: bold;">where</span> salary <span style="color: #4f97d7; font-weight: bold;">not</span> <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">select</span> <span style="color: #4f97d7;">max</span><span style="color: #bc6ec5;">(</span>salary<span style="color: #bc6ec5;">)</span> <span style="color: #4f97d7; font-weight: bold;">from</span> employees<span style="color: #4f97d7;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">select</span> <span style="color: #4f97d7;">max</span><span style="color: #4f97d7;">(</span>salary<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7; font-weight: bold;">from</span> employees <span style="color: #4f97d7; font-weight: bold;">where</span> salary &lt; <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">select</span> <span style="color: #4f97d7;">max</span><span style="color: #bc6ec5;">(</span>salary<span style="color: #bc6ec5;">)</span> <span style="color: #4f97d7; font-weight: bold;">from</span> employees<span style="color: #4f97d7;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">select</span> salary <span style="color: #4f97d7; font-weight: bold;">from</span> <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">select</span> salary <span style="color: #4f97d7; font-weight: bold;">from</span> Employee <span style="color: #4f97d7; font-weight: bold;">order</span> <span style="color: #4f97d7; font-weight: bold;">by</span> salary <span style="color: #4f97d7; font-weight: bold;">desc</span> <span style="color: #4f97d7; font-weight: bold;">limit</span> <span style="color: #a45bad;">2</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7; font-weight: bold;">as</span> emp <span style="color: #4f97d7; font-weight: bold;">order</span> <span style="color: #4f97d7; font-weight: bold;">by</span> salary <span style="color: #4f97d7; font-weight: bold;">asc</span> <span style="color: #4f97d7; font-weight: bold;">limit</span> <span style="color: #a45bad;">1</span>
</pre>
</div></li>
<li><p>
SQL Query to find Max Salary from each department.
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">select</span> depart_id, <span style="color: #4f97d7;">max</span><span style="color: #4f97d7;">(</span>salary<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7; font-weight: bold;">from</span> employee <span style="color: #4f97d7; font-weight: bold;">group</span> <span style="color: #4f97d7; font-weight: bold;">by</span> depart_id
</pre>
</div>

<p>
not depart<sub>id</sub>, use depart<sub>name</sub>
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">select</span> depart_name, <span style="color: #4f97d7;">max</span><span style="color: #4f97d7;">(</span>salary<span style="color: #4f97d7;">)</span> <span style="color: #4f97d7; font-weight: bold;">from</span> employee e <span style="color: #4f97d7; font-weight: bold;">right</span> <span style="color: #4f97d7; font-weight: bold;">join</span> department d <span style="color: #4f97d7; font-weight: bold;">on</span> e.depart_id = d.id  <span style="color: #4f97d7; font-weight: bold;">group</span> <span style="color: #4f97d7; font-weight: bold;">by</span> depart_id
</pre>
</div></li>
</ol>
</div>
</div>


<div id="outline-container-org8820501" class="outline-3">
<h3 id="org8820501">Hash index&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></h3>
<div class="outline-text-3" id="text-org8820501">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2020-04-05 日 20:58]</span></span>
</p>

<p>
使用一个 hash table 表示 index, 其中 key 是 column value 的 hash 值， value 是一个指针，指向具体的行。
</p>

<ol class="org-ol">
<li><p>
如何手动模拟 hash index 使用 B+ tree index
</p>

<p>
假如现在我们要为 column A 添加索引，那么可以新添加一个 column A<sub>hash</sub>，然后将 A<sub>hash</sub> 也作为一个 key。
</p></li>
</ol>
</div>
</div>
<div id="outline-container-org0186085" class="outline-3">
<h3 id="org0186085">Dockerfile ONBUILD command&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></h3>
<div class="outline-text-3" id="text-org0186085">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2020-04-05 日 14:45]</span></span>
</p>

<p>
这是一个 prefix command
</p>

<p>
当其他 Dockerfile command 被 prefix ONBUILD，那么该 command 不会在当前 Dockerfile 被 build 时运行，
而是以该 Dockerfile 构建的镜像为基础的孩子 Dockerfile 被 build 时在运行。
</p>
</div>
</div>
<div id="outline-container-orge6b491a" class="outline-3">
<h3 id="orge6b491a">MySQL index notion&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></h3>
<div class="outline-text-3" id="text-orge6b491a">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2020-04-05 日 20:33]</span></span>
</p>

<p>
In a high level， mysql index like a book index by which you can quickly find the page number of a specified theme.
</p>

<p>
At mysql, a index is a data structure at disk, every index has some keys, when you want to find which rows has specified value for
these keys，by this index, we do not need to scan all table.
</p>

<ol class="org-ol">
<li>Indexes reduce the amount of data the server has to examine.</li>
<li>Indexes help the server avoid sorting and temporary tables.</li>
<li>Indexes turn random I/O into sequential I/O</li>
</ol>
</div>
</div>
<div id="outline-container-org337d456" class="outline-3">
<h3 id="org337d456">B+ tree index limits&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></h3>
<div class="outline-text-3" id="text-org337d456">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2020-04-05 日 20:53]</span></span>
</p>

<ol class="org-ol">
<li>索引 keys 的顺序是重要的，因此在写 query 语句时 columns 的顺序必须与新建索引时一致。</li>
</ol>
</div>
</div>
<div id="outline-container-orga68e3e5" class="outline-3">
<h3 id="orga68e3e5">full-text index&#xa0;&#xa0;&#xa0;<span class="tag"><span class="NOTE">NOTE</span></span></h3>
<div class="outline-text-3" id="text-orga68e3e5">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2020-04-05 日 21:14]</span></span>
</p>

<p>
full-text index is for MATCH AGAINST operations.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: melp</p>
<p class="date">Created: 2020-04-07 二 17:12</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a></p>
</div>
</body>
</html>
